'\" rtp
.\" -*- nroff -*- vim: ft=nroff nocin nosi
.\"
.\" @(#) tpi_ip.7.man,v 0.9.2.10 2006/04/25 01:34:42 brian Exp
.\"
.\" =========================================================================
.\"
.\" Copyright (c) 2001-2006  OpenSS7 Corporation <http://www.openss7.com/>
.\"
.\" All Rights Reserved.
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.  The author(s) will take no responsibility in it.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" -------------------------------------------------------------------------
.\"
.\" U.S. GOVERNMENT RESTRICTED RIGHTS.  If you are licensing this Software
.\" on behalf of the U.S. Government ("Government"), the following
.\" provisions apply to you.  If the Software is supplied by the Department
.\" of Defense ("DoD"), it is classified as "Commercial Computer Software"
.\" under paragraph 252.227-7014 of the DoD Supplement to the Federal
.\" Acquisition Regulations ("DFARS") (or any successor regulations) and the
.\" Government is acquiring only the license rights granted herein (the
.\" license rights customarily provided to non-Government users).  If the
.\" Software is supplied to any unit or agency of the Government other than
.\" DoD, it is classified as "Restricted Computer Software" and the
.\" Government's rights in the Software are defined in paragraph 52.227-19
.\" of the Federal Acquisition Regulations ("FAR") (or any successor
.\" regulations) or, in the cases of NASA, in paragraph 18.52.227-86 of the
.\" NASA Supplement to the FAR (or any successor regulations).
.\"
.\" =========================================================================
.\" 
.\" Commercial licensing and support of this software is available from
.\" OpenSS7 Corporation at a fee.  See http://www.openss7.com/
.\" 
.\" =========================================================================
.\"
.\" Last Modified 2006/04/25 01:34:42 by brian
.\"
.\" -------------------------------------------------------------------------
.\"
.\" tpi_ip.7.man,v
.\" Revision 0.9.2.10  2006/04/25 01:34:42  brian
.\" - updated manual pages
.\"
.\" Revision 0.9.2.9  2006/04/24 22:13:59  brian
.\" - updated references
.\"
.\" Revision 0.9.2.8  2006/04/22 08:39:08  brian
.\" - updated manual pages
.\"
.\" Revision 0.9.2.7  2006/04/22 04:59:34  brian
.\" - updated manual pages for 2G drivers
.\"
.\" Revision 0.9.2.6  2006/04/22 01:06:35  brian
.\" - updating manual pages
.\"
.\" Revision 0.9.2.5  2006/04/05 09:44:28  brian
.\" - moved .so line and updated headers
.\"
.\" =========================================================================
.R1
bracket-label "\fR[\fB" "\fR]" "\fR, \fB"
no-default-database
database strinet.refs
accumulate
move-punctuation
abbreviate A
join-authors ", " ", " " and "
et-al " et al" 2 3
abbreviate-label-ranges ".."
sort-adjacent-labels
.R2
.so strinet.macros
.\"
.\"
.TH TPI-IP 7 "@PACKAGE_DATE@" "@PACKAGE@-@VERSION@" "Transport Provider Interface (TPI)"
.\"
.\"
.SH NAME
.B tpi_ip
\- Transport Provider Interface (TPI) \- Internet Protocol (IP) Corrigendum
.\"
.\"
.SH SYNOPSIS
.PP
.B #include <sys/tihdr.h>
.br
.B #include <sys/tpi_ip.h>
.HP
.BI "int " ip_stream " = open(" \fR\*(lq/dev/rawip\*(rq\fI ", " flags );
.PD 0
.HP
.BI "int " ip_stream " = open(" \fR\*(lq/dev/rawip2\*(rq\fI ", " flags );
.PD
.\"
.\"
.SH DESCRIPTION
.PP
.B TPI-IP
provides a Stream supporting the Transport Provider Interface (TPI),
.[
TPI Revision 2.0.0
.]
.BR tpi (7),
to the Internet Protocol (IP),
.[
rfc791
.]
.[
rfc1349
.]
.[
rfc2474
.]
.[
rfc3168
.]
.[
rfc3260
.]
.BR ip (7),
protocol service interface using the T-primitives of the
.BR tpi (7).
This interface is intended solely for use by user programs or protocol modules requiring the common
.BR tpi (7).
interface, such as the
.BR xti (3)
and
.BR sockets (3)
library.
.PP
The difference between the
.I /dev/rawip
and
.I /dev/rawip2
devices is that the later is the second generation STREAMS RAWIP driver fully implemented in
.IR STREAMS (4),
where the former opens a socket internal to the kernel and simply provides a TPI service interface
to that socket.  Also, the
.I /dev/rawip2
driver supports pseudo-connection-oriented modes whereas the
.I /dev/rawip
driver only supports pure connectionless mode.
.\"
.\"
.SS "ADDRESS FORMATS"
.PP
The IP address format is structured as follows:
.sp
.nf
\fC\s-1\
struct sockaddr_in {
    sa_family_t         sin_family;  /* Address family */
    unsigned short int  sin_port;    /* Port number */
    struct in_addr      sin_addr;    /* Internet address */
    /* padding */
};
\s+1\fP
.fi
.PP
The
.B sockaddr_in
structure contains the following members:
.TP \w'sin_family\(em'u
.I sin_family
The address family.  Always set to
.BR AF_INET " or " AF_UNSPEC .
.PD 0
.TP
.I sin_port
The port number of the transport endpoint.
.TP
.I sin_addr
The IP address of the transport endpoint.
.TP
.I (padding)
Padding to pad the size of the
.B sockaddr_in
structure to the size of a
.B sockaddr
structure.
.PD
.PP
The structure is padded to the size of a
.BR sockaddr
structure.
.\"
.\"
.SH "OPTIONS"
.PP
Options are formatted according to the
.B t_opthdr
structure described in
.BR xti (3).
A UDP transport provider compliant to this specification supports none, all or
any subset of the options defined here.  An implementation may restrict the
use of any of these options by offering them only in a privileged or read-only
mode.
.PP
.B TPI-UDP
provides options at the
.BR XTI_GENERIC " and " T_INET_IP "
option levels as described in the subsections that follow.  Of the
.B T_INET_IP
level protocol options, none of the options are of end-to-end significance.
.\"
.\"
.SS "XTI_GENERIC"
.PP
Options at this level are specific to the X/Open Transport Interface (XTI/TLI)
and are common to all transport providers.  For more information, see
.BR xti (3).
.PP
The options defined with the option level
.B XTI_GENERIC
are as follows:
.TP
.B XTI_DEBUG
Sets debugging flags for the Stream.  This option is formatted as an array of
.BR t_uscalar_t .
Legal values are implementation defined.  For more information, see
.BR xti (3).
.TP
.B XTI_LINGER
Sets whether, and the amount of time if, the Stream will linger waiting for
unsent data to be delivered.  This option is formatted as a
.B t_linger
structure as follows:
.sp
.nf
\fC\s-1\
struct t_linger {
    t_scalar_t l_onoff;    /* option on/off */
    t_scalar_t l_linger;   /* linger time */
};
\s-1\fP
.fi
.RS
.TP \w'l_linger\(em'u
.I l_onoff
Specifies whether to linger
.RB ( T_YES )
or not
.RB ( T_NO ).
Legal values are
.BR T_YES " and " T_NO .
.TP
.I l_linger
Specifies the amount of time (in seconds) to linger.  Legal values are
.BR T_INFINITE ", " T_UNSPEC
and all positive numbers including zero.
.RE
.IP ""
For more information, see
.BR xti (3).
.TP
.B XTI_RCVBUF
Specifies the size, in bytes, of the receive buffer.  This option is formatted
as a
.BR t_uscalar_t .
Legal values are all positive, non-zero numbers.  For more information, see
.BR xti (3).
.TP
.B XTI_RCVLOWAT
Specifies the low water mark above which received data will be indicated and
delivered to the user.  This option is formatted as
.BR t_uscalar_t .
Legal values are all positive, non-zero numbers.
For more information see
.BR xti (3).
.TP
.B XTI_SNDBUF
Specifies the size, in bytes, of the transmit buffer.  This option is
formatted as a
.BR t_uscalar_t .
Legal values are all positive, non-zero numbers.
For more information see
.BR xti (3).
.TP
.B XTI_SNDLOWAT
Specifies the low water mark above which queued data will be transmitted to
the peer.  This option is formatted as a
.BR t_uscalar_t .
Legal values are all positive, non-zero numbers.
For more information see
.BR xti (3).
.\"
.\"
.SS "T_INET_IP"
.PP
.TP
.B T_IP_OPTIONS
.\"IP per-packet options.
.\".sp
This option is used to set (retrieve) the OPTIONS field of each outgoing
(incoming) IP datagram.  It value is a string of octets composed of a number
of T_IP options, whose format matches those defined in the IP specification
with one exception: the list of addresses for the source routing option must
include the first-hop gateway at the beginning of the list of gateways.  The
first-hop gateway address will be extracted from the option list and the size
adjusted accordingly before use.
.sp
The option is disabled if it is specified with \*(lqno value\*(rq; that is,
with an option header only.
.sp
The functions
.BR t_connect (3)
(in synchronous mode),
.BR t_listen "(3), " t_rcvconnect "(3) and " t_rcvudata (3)
return the OPTIONS field, if any, of the received IP datagram associated with
this call.  The function
.BR t_rcvuderr (3)
returns the OPTIONS field of the data unit previously sent that produced the
error.  The function
.BR t_optmgmt ()
with
.B T_CURRENT
set retrieves the currently effective
.B T_IP_OPTIONS
that is sent with outgoing datagrams.
.sp
Common application never need this option.  It is mainly used for network
debugging and control purposes.
.sp
This option is formated as an array (maximum 40 elements) of
.BR "unsigned char" .
This option is an
.IR "absolute requirement" .
This option has
.IR "end-to-end significance" .
.TP
.B T_IP_TOS
.\"IP per-packet type of service.
.\".sp
This option is used to set (retrieve) the type-of-service filed of an
outgoing (incoming)
.B T_IP
datagram.  This field can be constructed by any OR'ed combination of one of
the precedence flags and the type-of-service flags.
.RS
.PP
.BI SET_TOS( prec ", " tos )
.PP
The option value is set using the macro
.BI SET_TOS( prec ", " tos )\fR,
where
.I prec
is set to one of the precedence flags and
.I tos
to one or an OR'ed combination of the type-of-service flags.
.BR  SET_TOS ()
returns the option value.
.TP
.I prec
The precedence flags specify datagram precedence, allowing senders to
indicate the importance of each datagram.  They are intended for
Department of Defence applications.  Applications using
.B T_IP_TOS
but not the precedence level should use the value of
.B T_ROUTINE
for precedence.
.I prec
can be one of the following values:
.RS
.TP \w'T_OVERRIDEFLASH\(em'u
.B T_ROUTINE
routine.
.PD 0
.TP
.B T_PRIORITY
priority precedence.
.TP
.B T_IMMEDIATE
immediate precedence.
.TP
.B T_FLASH
flash precedence.
.TP
.B T_OVERRIDEFLASH
flash override precedence.
.TP
.B T_CRITIC_ECP
flash override override precedence.
.TP
.B T_INETCONTROL
internetwork control.
.TP
.B T_NETCONTROL
network control.
.PD
.RE
.TP
.I tos
The type-of-service flags specify the type of service the IP datagram
desires.
.I tos
can be one of the following values:
.RS
.TP \w'T_OVERRIDEFLASH\(em'u
.B T_NOTOS
no type of service.
.PD 0
.TP
.B T_LDELAY
low delay.
.TP
.B T_HITHRPT
high throughput.
.TP
.B T_HIREL
high reliability.
.TP
.B T_LOCOST
low cost.
.PD
.RE
.PP
The functions
.BR t_connect "(3), " t_listen "(3), " t_rcvconnect "(3) and " t_rcvudata (3)
return the type-of-service
.PP
This option is formatted as an
.BR "unsigned char" .
This option is an
.IR "absolute requirement" .
This option has
.IR "end-to-end significance" .

.RE
.TP
.B T_IP_TTL
.\"IP per-packet time to live.
.\".sp
This option is used to set the time-to-live field in an outgoing IP
datagram.  It specifies how long, in seconds, the datagram is allowed to
remain in the Internet.  The time-to-live field of an incoming datagram is
not returned by any function (since it is not an option with
.IR "end-to-end significance" ).
.sp
This option is formatted as an
.BR "unsigned char" .
It can take on values between
.BR 0 " and " 255 .
This option is an
.IR "absolute requirement" .
This option has
.IR "local significance" .
.TP
.B T_IP_REUSEADDR
.\"Allow local address reuse.
.\".sp
Many TCP implementations do not allow the user to bind more than one
transport endpoint address with identical port numbers.  If
.B T_IP_REUSEADDR
is set to
.B T_YES
this restriction is relaxed in the sense that it is now allowed to bind an
transport endpoint to an address with a port number and an underspecified
Internet address (\*(lqwild card\*(rq address) and further endpoints to
addresses with the same port number and (mutually exclusive) fully specified
Internet addresses.
.sp
This option is formatted as an
.BR "unsigned int" .
It can take on values
.BR T_YES " or " T_NO .
This option is an
.IR "absolute requirement" .
This option has
.IR "local significance" .
.TP
.B T_IP_DONTROUTE
.\"Just use interface address.
.\".sp
This option indicates that outgoing messages should bypass the standard
routing facilities.  It is mainly used for testing and development.
.sp
This option is formatted as an
.BR "unsigned int" .
It can take on values
.BR T_YES " or " T_NO .
This option is an
.IR "absolute requirement" .
This option has
.IR "local significance" .
.TP
.B T_IP_BROADCAST
.\"Permit sending of broadcast messages.
.\".sp
This option requests permission to send broadcast datagrams.  It was
defined to make sure that broadcasts are not generated by mistake.  The
use of this option is often restricted to privileged users.
.sp
This option is formated as an
.BR "unsigned int" .
It can take on values
.BR T_YES " or " T_NO .
This option is an
.IR "absolute requirement" .
This option has
.IR "local significance" .
.\"
.\"
.SH LOCAL MANAGEMENT INTERFACE
.PP
Local management interface primitives apply to both the true connectionless
mode and the pseudo-connection-oriented modes of operation.  These primitives
are used to query, control options of, and bind addresses to, the local
transport service interface.  See
.BR tpi (7)
for more information on the local management service interface primitives.
.\"
.SS T_INFO_REQ\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7).
.\"
.SS T_INFO_ACK\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7).
.TP
.I TSDU_size
The
.B TPI-IP
provider supports a maximum payload size of 65535 bytes minus 40 bytes of IP
header, or 65495 bytes.
.TP
.I ETSDU_size
The
.B TPI-IP
provider does not support the concept of expedited data.  This field returns
.BR T_INVALID ,
and any attempt to send expedited data using the
.BR T_EXDATA_REQ (7)
primitive will return
.RB [ TNOTSUPPORT ].
.TP
.I CDATA_size
The
.B TPI-IP
provider supports the concept of connection data in pseudo-connect-oriented
mode only.  In connectionless mode, this field returns
.BR T_INVALID .
In pseudo-connection-oriented mode, this field returns 65495, as does the
.I TSDU_size
field, above.
.TP
.I DDATA_size
The
.B TPI-IP
provider supports the concept of disconnection data in pseudo-connect-oriented
mode only.  In connectionless mode, this field returns
.BR T_INVALID .
In pseudo-connection-oriented mode, this field returns 65495, as does the
.I TSDU_size
field, above.
.TP
.I ADDR_size
The maximum size of an IP address.  This field returns the size of a
.B sockaddr_in
structure.  This field may return a larger number at a later date if
.BR TPI-IP
ever supports multi-homing.
.TP
.I OPT_size
This is the maximum size of the
.I OPT_length
field in T-primitives which support options.  This value returns 65535 in the
current implementation.
.TP
.I TIDU_size
This is the maximum size of the interface data unit, which is the maximum size
of data that can be transferred across the interface using a single
.BR getmsg (2)
or
.BR putmsg (2)
system call.  This size is always less than or equal to the
.IR TSDU_size ,
above.  In the current implementation, the size is 65495 as is the
.IR TSDU_size ,
above.
.TP
.I SERV_type
The service type is one of the following:
.RS
.TP \w'T_COTS_ORD\(em'u
.B T_CLTS
Connectionless mode service.  The
.B TPI-IP
provider supports connectionless mode service by default.  When a Stream is
first opened,
.B T_CLTS
will be returned.  After a successful bind or connect operation, the value
returned  may be
.BR T_COTS ,
instead.
.TP
.B T_COTS
Connection-oriented mode service without orderly release.  The
.B TPI-IP
provider supports a pseudo-connection-oriented mod service of this type.
.TP
.B T_COTS_ORD
Connection-oriented mode service with orderly release.  The
.B TPI-IP
provider does not support orderly release and this service type will not be
returned in the
.BR T_INFO_ACK(7).
.RE
.TP
.I CURRENT_state
The current state of the service interface as described in
.BR tpi (7).
.TP
.I PROVIDER_flag
Provider flags are a bitwise OR of zero or more of the following:
.RS
.TP \w'T_COTS_ORD\(em'u
.B T_SNDZERO
When set, indicates that the transport user is permitted to send data with a
message length of zero (0).  The
.B TPI-IP
provider does not support the transmission of zero length TSDUs.  This flag
will be clear.
.TP
.B XPG4_1
Indicates that the transport provider conforms to XTI in XTP4 and supports the
new primitives
.BR T_ADDR_REQ (7)
and
.BR T_ADDR_ACK (7).
This flag is normally set.
.RE
.\"
.SS T_ADDR_REQ\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7).
.\"
.SS T_ADDR_ACK\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7).
.TP
.IR LOCADDR_length " and " LOCADDR_offset
Indicates the length and offset from the beginning of the message block of the
.B sockaddr_in
structure that describes the
.B TPI-IP
addresses to which the Stream is bound.  If the Stream is not in a bound
state, then
.IR LOCADDR_length " and " LOCADDR_offset
both return zero (0).
.TP
.IR REMADDR_length " and " REMADDR_offset
Indicates the length and offset from the beginning of the message block of the
.B sockaddr_in
structure that describes the
.B TPI-IP
addresses to which the Stream is connected.  If the Stream is not in a
connected or connecting state, then
.IR REMADDR_length " and " REMADDR_offset
return zero (0).
.IP ""
Note that the
.B TPI-IP
provider is only in a connected or connecting state when operating in the
pseudo-connection-oriented mode.  The pseudo-connection-oriented mode is only
supported by the second generation RAWIP driver,
.BR rawip2 (4).
.\"
.SS T_CAPABILITY_REQ\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7).
.\"
.SS T_CAPABILITY_ACK\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7),
and contains the
.BR T_info_ack (7)
structure interpreted as described under
.RI \(lq T_INFO_ACK ,\(rq
above.
.\"
.SS T_BIND_REQ\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7).
.TP
.IR ADDR_length " and " ADDR_offset
Specifies the length and offset from the beginning of the message block of
the
.B sockaddr_in
structure that contains the
.B TPI-IP
address to bind.  The
.B TPI-IP
provider supports missing bind addresses, wildcard addresses and the address
.BR INADDR_ANY .
This field can currently only contain zero or one address.
.TP
.I CONIND_number
Specifies the number of connection indications.  Specifying a non-zero number
of connection indications will place the provider in the
pseudo-connection-oriented mode.  Any packet received from a unique source
address will generate a connection indication accompanied by data.  Connection
indications can be accepted with or without data or refused with or without
data.  This number specifies the maximum number of outstanding connection
indications (those that are neither accepted nor refused) that the provider
will deliver.
.\"
.SS T_BIND_ACK\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7).
.TP
.IR ADDR_length " and " ADDR_offset
Indicates the length and the offset from the beginning of the message block of
the
.B sockaddr_in
structure that contains the
.B TPI-IP
address that was bound.  This field can currently only contain one address.
.IP ""
The bound address,
.IR sin_addr ,
returned in this field may be
.BR INADDR_ANY " if " INADDR_ANY
was requested, or no address was requested with the bind.
.IP ""
The
.I sin_port
component of the address will indicate the bound protocol number.  If no
address was provided on the bind, the bound protocol number will be that of
UDP (protocol number 17).
.TP
.I CONIND_number
Indicates the negotiated number of connection indications.  This is normally
the same value as requested; however, if the user requests a number that is
considered too large, the number might be a more conservative value.
.IP ""
Note that a non-zero number is returned in this field only if the provider is
in the pseudo-connection-oriented mode.
.\"
.SS T_UNBIND_REQ\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7).
.\"
.SS T_OK_ACK\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7).
.\"
.SS T_ERROR_ACK\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7).
.\"
.SS T_OPTMGMT_REQ\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
with options described under
.RI \(lq OPTIONS \(rq,
above.
.\"
.SS T_OPTMGMT_ACK\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
with options described under
.RI \(lq OPTIONS \(rq,
above.
.\"
.\"
.SH PROTOCOL SERVICE INTERFACE
.PP
Protocol service interface primitives apply to either the true connectionless
mode or the pseudo-connection-oriented modes of operation.  These primitives
are used to form connections, control options, and exchange transport service
data units between transport users.  See
.BR tpi (7)
for more information on the protocol service interface primitives.
.PP
Note that connection-oriented protocol service interface primitives are only
supported by the second generation RAWIP driver,
.BR raqip2 (4),
and are only available when the interface has been placed into the
pseudo-connection-oriented mode.
.\"
.SS T_UNITDATA_REQ\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the connectionless mode.
.TP
.IR DEST_length " and " DEST_offset
Specifies the length and offset from the beginning of the message block of the
.B sockaddr_in
structure containing the destination IP address to which the message is to be
sent.
.TP
.IR OPT_length " and " OPT_offset
Specifies the length and offset from the beginning of the message block of the
options requested for the packet.  See
.RI \(lq OPTIONS ,\(rq
above.  The only options that have an affect of the IP packets send by the
.B TPI-IP
provider are as follows:
.RS
.TP
.B T_IP_OPTIONS
Specifying a value for this option will affect the IP options in the outgoing
packet.  The value specified will be used instead of the default for the
Stream.  (In the current implementation, this option is not supported.)
.TP
.B T_IP_TOS
Specifying a value for this option will affect the type of service field in
the outgoing packet.  The value specified will be used instead of the default
for the Stream.
.TP
.B T_IP_TTL
Specifying a value for this option will affect the time to live field in
the outgoing packet.  The value specified will be used instead of the default
for the Stream.
.TP
.B T_IP_ADDR
Specifying a value for this option will affect the source address of the
associated outgoing packet.  The value specified will be used instead of the
default for the outgoing network interface.
.RE
.\"
.SS T_UNITDATA_IND\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the connectionless mode.
.TP
.IR SRC_length " and " SRC_offset
Indicates the length and offset from the beginning of the message block of the
.B sockaddr_in
structure containing the source address from which the IP packet was sent.
.TP
.IR OPT_length " and " OPT_offset
Indicates the length and offset from the beginning of the message block of the
options present in the received packet.  See
.RI \(lq OPTIONS ,\(rq
above.  The only options that are indicated by the
.B TPI-IP
provider are as follows:
.RS
.TP
.B T_IP_OPTIONS
Indicates the IP options that were present in the received packet.  If no IP
options were present, this option value will not be indicated.  This value
does not affect the value used for outgoing packets.  (In the current
implementation, this option is not supported.)
.TP
.B T_IP_TOS
Indicates the value of the type of service field from the received packet.
This value does not affect the value used for outgoing packets.
.TP
.B T_IP_TTL
Indicates the value of the time to live field from the received packet.
This value does not affect the value used for outgoing packets.
.TP
.B T_IP_ADDR
Indicates the value of the IP destination (local) address from the received
packet.  This value does not affect the value used for outgoing packets.
.RE
.\"
.SS T_UDERROR_IND\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the connectionless mode.
.TP
.IR DEST_length " and " DEST_offset
Indicates the length and offset from the beginning of the message block of the
.B sockaddr_in
structure that contains the
.B TPI-IP
address to which the unit data that encountered the error was sent.
.TP
.IR OPT_length " and ' OPT_offset
Indicates the length and offset from the beginning of the message block of the
options associated with the unit data that encountered the error.  See
.RI \(lq OPTIONS ,\(rq
above.
.TP
.I ERROR_type
Error types in connectionless mode are a combination of the ICMP error type in
the second least significant byte combined with the ICMP error code in the
least significant byte.  Values are as follows:
.sp
.TS
tab(:);
lblbci.
_
Code:Type:Value
_
ICMP_DEST_UNREACH:ICMP_NET_UNREACH:0x0300
:ICMP_HOST_UNREACH:0x0301
:ICMP_PROT_UNREACH:0x0302
:ICMP_PORT_UNREACH:0x0303
:ICMP_FRAG_NEEDED:0x0304
:ICMP_SR_FAILED:0x0305
:ICMP_NET_UNKNOWN:0x0306
:ICMP_HOST_UNKNOWN:0x0307
:ICMP_HOST_ISOLATED:0x0308
:ICMP_NET_ANO:0x0309
:ICMP_HOST_ANO:0x030a
:ICMP_NET_UNR_TOS:0x030b
:ICMP_HOST_UNR_TOS:0x030c
:ICMP_PKT_FILTERED:0x030d
:ICMP_PREC_VIOLATION:0x030e
:ICMP_PREC_CUTOFF:0x030f
_
ICMP_SOURCE_QUENCH:\-:0x0400
_
ICMP_TIME_EXCEEDED:ICMP_EXC_TTL:0x0b00
:ICMP_EXC_FRAGTIME:0x0b01
_
.TE
.\"
.SS T_CONN_REQ\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode, with the following exceptions:
.IP 1. \w'0.\(em'u
The primitive can be issued on a Stream that has not yet been bound; i.e. that
is in the
.I TS_UNBND
state.  The
.B TPI-IP
provider will autobind the Stream to an IP address of
.BR INADDR_ANY ,
and the specified IP protocol number.  The resulting Stream will be a
pseudo-connection-oriented mode Stream.  This is primarily for compatibility
with the
.BR sockets (3)
library, but is also the only way that a protocol can be bound and then
pseudo-connection-oriented mode entered.  The TPI
.[
TPI Revision 2.0.0
.]
specification indicates that the response in this situation should be an
.BR T_ERROR_ACK (7)
primitive with either a
.RB [ TNOTSUPPORT ]
or
.RB [ TOUTSTATE ]
error.
.IP 2.
The primitive can be issued on a Stream that has been bound, but which reports
a service type of
.I T_CLTS
in the
.BR T_INFO_ACK (7)
primitive.  This, again, is primarily for compatibility with the
.BR sockets (3)
library.  The TPI
.[
TPI Revision 2.0.0
.]
specification indicates that the response in this situation should be an
.BR T_ERROR_ACK (7)
primitive with a
.RB [ TNOTSUPPORT ]
error.
.TP
.IR DEST_length " and " DEST_offset
Specifies the length and offset from the beginning of the message block of the
.B sockaddr_in
structure containing the destination IP address and IP protocol number to
which the connection is to be formed.
.TP
.IR OPT_length " and " OPT_offset
Specifies the length and offset from the beginning of the message block of the
options requested for the connection.  See
.RI \(lq OPTIONS ,\(rq
above.  The only options that have an effect on the IP packets sent by the
.B TPI-IP
provider are as follows:
.RS
.TP
.B T_IP_OPTIONS
Specifying a value for this option will affect the IP options in the
associated outgoing packet and further packets sent using the
.BR T_DATA_REQ (7)
primitive.  The value specified will become the default value for the Stream.
(In the current implementation, this options is not supported.)
.TP
.B T_IP_TOS
Specifying a value for this option will affect the type of service field in
the associated outgoing packet and further packets sent using the
.BR T_DATA_REQ (7)
primitive.  The value specified will become the default value for the Stream.
.TP
.B T_IP_TTL
Specifying a value for this option will affect the time to live field in the
associated outgoing packet and further packets sent using the
.BR T_DATA_REQ (7)
primitive.  The value specified will become the default value for the Stream.
.TP
.B T_IP_ADDR
Specifying a value for this option will affect the source address of the
associated outgoing packet and further packets sent using the
.BR T_DATA_REQ (7)
primitive.  The value specified will become the default value for the Stream.
.RE
.IP ""
Other option values specified with the primitive will be ignored.
.\"
.SS T_CONN_CON\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode, with the following exceptions:
.IP 1. \w'0.\(em'u
The
.B TPI-IP
provider does not provider true confirmation of a connection in
pseudo-connection-oriented mode.  The confirmation is issued automatically by
the
.B TPI-IP
provider upon receipt of a proper
.BR T_CONN_REQ (7)
primitive.
.TP
.IR RES_length " and " RES_offset
Indicates the length and offset from the beginning of the message block of the
.B sockaddr_in
structure that contains the responding address, which, in this case, is the
same as the requested destination address.
.TP
.IR OPT_length " and " OPT_offset
Indicates the length and offset from the beginning of the message block of the
options present in the connection request,
.BR T_CONN_REQ (7).
See
.RI \(lq OPTIONS ,\(rq
above.  The option values represent negotiation with the local provider only
and are not end-to-end.  The only options that are indicated by the
.B TPI-IP
provider are as follows:
.RS
.TP
.B T_IP_OPTIONS
Indicates the IP options that were present in the connection request.  If no
IP options were present, this option value will not be indicated.  This value
reflects the value used for outgoing packets.  (In the current implementation,
this option is not supported.)
.TP
.B T_IP_TOS
Indicates the value of the type of service field from the connection request.
This value reflects the value used for outgoing packets.
.TP
.B T_IP_TTL
Indicates the value of the time to live field from the connection request.
This value reflects the value used for outgoing packets.
.TP
.B T_IP_ADDR
Indicates the value of the IP source (local) address from the connection
request.  This value reflects the value used for outgoing packets.
.RE
.IP ""
No other option values will be indicated.
.\"
.SS T_CONN_IND\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode, with the following exceptions:
.IP 1. \w'0.\(em'u
The
.B TPI-IP
provider does not provider true connection-oriented modes.  In
pseudo-connection-oriented mode, with a listening Stream, connection
indications are synthesized from any received packet that matches the
listening Stream and delivered as a connection indication (with data).
.TP
.IR SRC_length " and " SRC_offset
Indicats the length and offset from the beginning of the message block of the
.B sockaddr_in
structure containing the source address and protocol number from which the
indicated packet was sent.
.TP
.IR OPT_length " and " OPT_offset
Indicates the length and offset from the beginning of the message block of the
options present in the packet.  See
.RI \(lq OPTIONS ,\(rq
above.  The only options that are indicated by the
.B TPI-IP
provider are a follows:
.RS
.TP
.B T_IP_OPTIONS
Indicates the IP options that were present in the received packet.  If no IP
options were present, this option value will not be indicated.  This value
does not affect the value used for outgoing packets.  (In the current
implementation, this option is not supported.)
.TP
.B T_IP_TOS
Indicates the value of the type of service field from the received packet.
This value does not affect the value used for outgoing packets.
.TP
.B T_IP_TTL
Indicates the value of the time to live field from the received packet.  This
value does not affect the value used fr outgoing packets.
.TP
.B T_IP_ADDR
Indicates the value of the IP destination (local) address from the received
packet.  This vlaue does not affect the value used for outgoing packets.
.RE
.IP ""
No other options values will be indicated.
.TP
.I SEQ_number
Indicates the sequence number for the connection indication to be used by the
TS user in a subsequent
.BR T_DISCON_REQ (7)
or
.BR T_CONN_RES (7)
primitive.
.\"
.SS T_CONN_RES\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode, with the following exceptions:
.IP 1. \w'0.\(em'u
The
.B TPI-IP
provider does not support true connection-oriented modes: only a
pseudo-connection-oriented mode.  Accepting a connection indication with this
primitive will deliver queued and any further received packets with the same
source and destination addresses and protocol number to the accepting Stream.
.IP 2.
Default options associated with the Stream are not negotiated end-to-end and
are simply set as specified.
.TP
.I ACCEPTOR_id
Specifies the acceptor identifier of the Stream onto which the connection is
to be accepted.  If the connection is to be accepted on the same Stream upon
which the corresponding
.BR T_CONN_IND (7)
was received, this field should be zero (0).  It is an error to accept a
connection on the listening Stream if there is more than one connection
indication outstanding.
.TP
.IR OPT_length " and " OPT_offset
Specifies the length and offset from the beginning of the message block of the
options requested for the connection.  See
.RI \(lq OPTIONS ,\(rq
above.  The only options that have an effect on the IP packets sent by the
.B TPI-IP
provider are as follows:
.RS
.TP
.B T_IP_OPTIONS
Specifying a value for this option will affect the IP options in the
associated outgoing packet and for further packets sent using the
.BR T_DATA_REQ (7)
primitive.  The value specified will become the default value for the Stream.
(In the current implementation, this options is not supported.)
.TP
.B T_IP_TOS
Specifying a value for this option will affect the type of service field in
the associated outgoing packet and for further packets sent using the
.BR T_DATA_REQ (7)
primitive.  The value specified will become the default for the Stream.
.TP
.B T_IP_TTL
Specifying a value for this option will affect the time to live field in
the associated outgoing packet and for further packets sent using the
.BR T_DATA_REQ (7)
primitive.  The value specified will become the default for the Stream.
.TP
.B T_IP_ADDR
Specifying a value for this option will affect the source address of
the associated outgoing packet and for further packets sent using the
.BR T_DATA_REQ (7)
primitive.  The value specified will become the default for the Stream.
.RE
.IP ""
Other option values specified with the primitive will be ignored.
.TP
.I SEQ_number
Specifies the sequence number in the corresponding
.BR T_CONN_IND (7)
primitive to which this primitive is responding.
.\"
.SS T_DATA_REQ\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode.
.TP
.I MORE_flag
The
.B TPI-IP
provider does not support segmentation.  If this flag is non-zero, an
.RB [ EPROTO ]
fatal error will be issued.
.\"
.SS T_DATA_IND\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode.
.TP
.I MORE_flag
The
.B TPI-IP
provider does not support segmentation.  This flag will always be indicated as
zero (0).
.\"
.SS T_EXDATA_REQ\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode.
The
.B TPI-IP
provider does not support expedited data in the pseudo-connection-oriented
mode.  If this primitive is issued by the TS user, a
.RB [ EPROTO ]
fatal error will be issued by the provider.
.TP
.I MORE_flag
The
.B TPI-IP
provider does not support segmentation.  If this flag is non-zero, an
.RB [ EPROTO ]
fatal error will be issued.
.\"
.SS T_EXDATA_IND\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode.
The
.B TPI-IP
provider does not support expedited data and will not issue this primitive.
.TP
.I MORE_flag
The
.B TPI-IP
provider does not support segmentation.  This flag will always be indicated as
zero (0).
.\"
.SS T_OPTDATA_REQ\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode.
.TP
.I DATA_flag
The
.B TPI-IP
provider does not support segmentation.  Segmentation of IP packets is
performed at a lower layer.  Therefore, if the
.I DATA_flag
field contains a non-zero value, the provider will issue a fatal
.RB [ EPROTO ]
error.
.TP
.IR OPT_length " and " OPT_offset
Specifies the length and offset from the beginning of the message block of the
options requested for the packet.  See
.RI \(lq OPTIONS ,\(rq
above.  The only options that have an effect on the IP packets sent by the
.B TPI-IP
provider are as follows:
.RS
.TP
.B T_IP_OPTIONS
Specifying a value for this option will affect the IP options in the
associated outgoing packet.  The value specified will be used instead of the
default for the Stream.  (In the current implementation, this option is not
supported.)
.TP
.B T_IP_TOS
Specifying a value for this option will affect the type of service field in
the associated outgoing packet.  The value specified will be used instead of
the default for the Stream.
.TP
.B T_IP_TTL
Specifying a value for this option will affect the time to live field in
the associated outgoing packet.  The value specified will be used instead of
the default for the Stream.
.TP
.B T_IP_ADDR
Specifying a value for this option will affect the source addres of
the associated outgoing packet.  The value specified will be used instead of
the default value for the outgoing network interface.
.RE
.IP ""
Other option values specified with the primitive will be ignored.
.\"
.SS T_OPTDATA_IND\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode.
.TP
.I DATA_flag
The
.B TPI-IP
provider performs reassembly of fragmented IP packets before delivery.
Therefore, the
.I DATA_flag
will always contain zero (0).
.TP
.IR OPT_length " and " OPT_offset
Indicates the length and offset from the beginning of the message block of the
options present in the packet.  See
.RI \(lq OPTIONS ,\(rq
above.  The only options that are indicated by the
.B TPI-IP
provider are as follows:
.RS
.TP
.B T_IP_OPTIONS
Indicates the IP options that were present in the received packet.  If no IP
options were present, this option value will not be indicated.  (In the
current implementation, this option is not supported.)
.TP
.B T_IP_TOS
Indicates the value of the type of service field from the received packet.
.TP
.B T_IP_TTL
Indicates the time to live field from the received packet.
.TP
.B T_IP_ADDR
Indicates the value of the IP destination (local) address on which the packet
was received.
.RE
.IP ""
No other option values will be indicated.
.\"
.SS T_DISCON_REQ\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode.
.TP
.I SEQ_number
When used to reject a connection indication, specifies the sequence number
from the corresponding
.BR T_CONN_IND (7)
primitive; zero (0), otherwise.
.\"
.SS T_DISCON_IND\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode.
.TP
.I DISCON_reason
Disconnect reasons in pseudo-connection-oriented mode are a combination of the
ICMP error type in the second least significant byte combined with the ICMP
error code in the least significant byte.  Values are as follows:
.sp
.TS
tab(:);
lblbci.
_
Code:Type:Value
_
ICMP_DEST_UNREACH:ICMP_NET_UNREACH:0x0300
:ICMP_HOST_UNREACH:0x0301
:ICMP_PROT_UNREACH:0x0302
:ICMP_PORT_UNREACH:0x0303
:ICMP_FRAG_NEEDED:0x0304
:ICMP_SR_FAILED:0x0305
:ICMP_NET_UNKNOWN:0x0306
:ICMP_HOST_UNKNOWN:0x0307
:ICMP_HOST_ISOLATED:0x0308
:ICMP_NET_ANO:0x0309
:ICMP_HOST_ANO:0x030a
:ICMP_NET_UNR_TOS:0x030b
:ICMP_HOST_UNR_TOS:0x030c
:ICMP_PKT_FILTERED:0x030d
:ICMP_PREC_VIOLATION:0x030e
:ICMP_PREC_CUTOFF:0x030f
_
ICMP_SOURCE_QUENCH:\-:0x0400
_
ICMP_TIME_EXCEEDED:ICMP_EXC_TTL:0x0b00
:ICMP_EXC_FRAGTIME:0x0b01
_
.TE
.TP
.I SEQ_number
The sequence number of a currently outstanding connection indication to which
the disconnect corresponds.  This value is non-zero only on a listening Stream
for which an outstanding
.BR T_CONN_IND (7)
primitive has been issued with no
.BR T_DISCON_REQ (7)
or
.BR T_CONN_RES (7)
having been issued by the TS user with the same sequence number.
.\"
.SS T_ORDREL_REQ\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode; however, the
.B TPI-IP
provider does not support orderly release.
If the TS user issues this primitive, the provider will negatively acknowledge
the primitive with a fatal
.RB [ EPROTO ]
error.
.\"
.SS T_ORDREL_IND\fR(7)
.PP
This primitive is interpreted as in
.BR tpi (7)
in the pseudo-connection-oriented mode; however, the
.B TPI-IP
provider does not support orderly release.
The provider will not issue this primitive.
.\"
.\"
.SH IOCTLS
.PP
The
.B TPI-IP
provider does not support input-output controls.  For a standard set of
input-output controls supporting the
.BR xti (3)
library functions, push the
.BR timod (4)
module.
.\"
.\"
.SH "ERROR HANDLING"
.PP
Error handling is in accordance with
.BR tpi (7).
.\"
.\"
.SH ERRORS
.PP
Errors are in accordance with
.BR tpi (7).
They are repeated here as follows:
.\"
.SS Error Acknowledgement Codes
.PP
The following error codes can be present in the
.I TLI_error
field of the
.BR T_ERROR_ACK (7)
primitive.
.TP \w'[TPROVMISMATCH]\(em'u
.RB [ TBADADDR ]
Bad address format.
.PD 0
.TP
.RB [ TBADOPT ]
Bad options format.
.TP
.RB [ TACCES ]
Bad permissions.
.TP
.RB [ TBADF ]
Bad file descriptor.
.TP
.RB [ TNOADDR ]
Unable to allocate an address.
.TP
.RB [ TOUTSTATE ]
Would place interface out of state.
.TP
.RB [ TBADSEQ ]
Bad call sequence number.
.TP
.RB [ TSYSERR ]
A system error occurred.  The UNIX error code is present in the
.I UNIX_error
field of the primitive.
.TP
.RB [ TBADDATA ]
Bad amount of data.
.TP
.RB [ TBADFLAG ]
Bad flags.
.TP
.RB [ TNOTSUPPORT ]
Not supported.
.TP
.RB [ TADDRBUSY ]
Address already in use.
.TP
.RB [ TPROVMISMATCH ]
Not same transport provider.
.TP
.RB [ TRESQLEN ]
Connection acceptor has qlen > 0.
.TP
.RB [ TRESADDR ]
Conn. acceptor bound to different address.
.PD
.\"
.SS Unitdata Error and Disconnect Codes
.PP
The following error codes can be present in the
.I ERROR_type
field of a
.BR T_UDERROR_IND (7)
primitive, or in the
.I DISCON_reason
field of a
.BR T_DISCON_IND (7)
primitive.
.TP \w'[ICMP_DEST_UNREACH/ICMP_PREC_VIOLATION]\(em'u
.RB [ ICMP_DEST_UNREACH / ICMP_NET_UNREACH ]
Network unreachable.
.PD 0
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_HOST_UNREACH ]
Host unreachable.
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_PROT_UNREACH ]
UDP protocol unreachable.
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_PORT_UNREACH ]
UDP port unreachable.
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_FRAG_NEEDED ]
Fragmentation needed and none requested.
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_SR_FAILED ]
Source route failed.
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_NET_UNKNOWN ]
Network unknown.
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_HOST_UNKNOWN ]
Host unknown.
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_HOST_ISOLATED ]
Host isolated.
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_NET_ANO ]
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_HOST_ANO ]
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_NET_UNR_TOS ]
Type of service unrecognized by network.
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_HOST_UNR_TOS ]
Type of service unrecognized by host.
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_PKT_FILTERED ]
Packet filtered.
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_PREC_VIOLATION ]
Precedence violation.
.TP
.RB [ ICMP_DEST_UNREACH / ICMP_PREC_CUTOFF ]
Precedence cutoff.
.TP
.RB [ ICMP_SOURCE_QUENCH ]
Source quench (congestion).
.TP
.RB [ ICMP_TIME_EXCEEDED / ICMP_EXC_TTL ]
Time to live exceeded (too many hops).
.TP
.RB [ ICMP_TIME_EXCEEDED / ICMP_EXC_FRAGTIME ]
Fragmentation time exceeded.
.PD
.\"
.\"
.SH NOTICES
.PP
.B RAWIP
has several implementations.  This manpage is for the
.BR INET (4)
implementation that provides
.BR tpi (7)
access to the Linux NET4 version of
.BR RAWIP.
For more information on the Linux NET4 version, see
.BR rawip (7).
.\"
.\"
.SH "SEE ALSO"
.PP
.BR ip (7),
.BR rawip (4),
.BR rawip2 (4),
.BR tpi (7),
.BR xti (3),
.BR sockets (3).
.\"
.\"
.SH COMPATIBILITY
.PP
The
.B @PACKAGE_TITLE@
implementation of
.BR RAWIP
for
.I STREAMS
is largely compatible with
.IR STREAMS -based
implementations such as Lachman or Mentat TCP/IP stacks and
.IR Solaris \(rg
documentation.
.[
soldoc
.]
.\"
.\"
.SH CONFORMANCE
.PP
This interface conforms to TPI Version 2, Draft 2,
.[
TPI Revision 2.0.0
.]
except where indicated.
.\"
.\"
.SH HISTORY
.PP
The Transport Provider Interface first appeared in SVR 4.
.[
svr4
.]
.\"
.\"
.XX
.[
magic
.]
.[
advprog
.]
.[
$LIST$
.]
.TI
